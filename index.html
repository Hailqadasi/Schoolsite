<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù…Ø³Ø§Ø¨Ù‚Ø© Ø£Ø¬Ù…Ù„ ØµÙˆØ±Ø©</title>

<style>
body{
    font-family: Arial;
    background:#f5f5f5;
    margin:0;
    padding:15px;
}
h2{text-align:center}
.box{
    background:#fff;
    padding:15px;
    border-radius:10px;
    margin-bottom:20px;
}
img{
    max-width:100%;
    border-radius:10px;
}
button{
    padding:8px 15px;
    border:none;
    border-radius:6px;
    background:#007bff;
    color:#fff;
    cursor:pointer;
    margin:5px;
}
.vote{background:#28a745}
.best{border:3px solid gold}
</style>
</head>

<body>

<h2>ğŸ“¸ Ù…Ø³Ø§Ø¨Ù‚Ø© Ø£Ø¬Ù…Ù„ ØµÙˆØ±Ø©</h2>

<!-- Ø±ÙØ¹ ØµÙˆØ±Ø© -->
<div class="box">
    <!-- ÙƒØ§Ù…ÙŠØ±Ø§ -->
    <input type="file" id="cameraInput" accept="image/*" capture="environment" hidden>
    <!-- Ù…Ø¹Ø±Ø¶ -->
    <input type="file" id="galleryInput" accept="image/*" hidden>

    <button onclick="cameraInput.click()">ğŸ“· Ø§Ù„ØªÙ‚Ø§Ø· ØµÙˆØ±Ø©</button>
    <button onclick="galleryInput.click()">ğŸ–¼ï¸ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù† Ø§Ù„Ø¬ÙˆØ§Ù„</button>
</div>

<!-- Ø£Ø¬Ù…Ù„ ØµÙˆØ±Ø© -->
<div class="box">
    <h3>ğŸ† Ø£Ø¬Ù…Ù„ ØµÙˆØ±Ø©</h3>
    <div id="bestImage">Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙˆØ± Ø¨Ø¹Ø¯</div>
</div>

<!-- ÙƒÙ„ Ø§Ù„ØµÙˆØ± -->
<div class="box">
    <h3>â­ Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©</h3>
    <div id="images"></div>
</div>

<script>
let images = JSON.parse(localStorage.getItem("images") || "[]");
const voterId = localStorage.getItem("voterId") || Date.now().toString();
localStorage.setItem("voterId", voterId);

cameraInput.onchange = e => handleImage(e.target.files[0]);
galleryInput.onchange = e => handleImage(e.target.files[0]);

function handleImage(file){
    if(!file) return;
    const reader = new FileReader();
    reader.onload = () => {
        images.push({
            id: Date.now(),
            src: reader.result,
            votes: 0,
            voters: []
        });
        save();
    };
    reader.readAsDataURL(file);
}

// ØªØµÙˆÙŠØª
function vote(id){
    const img = images.find(i => i.id === id);
    if(img.voters.includes(voterId)){
        alert("âŒ Ù„Ù‚Ø¯ ØµÙˆÙ‘Øª Ù…Ø³Ø¨Ù‚Ù‹Ø§");
        return;
    }
    img.votes++;
    img.voters.push(voterId);
    save();
}

// Ø­ÙØ¸ ÙˆØ¹Ø±Ø¶
function save(){
    localStorage.setItem("images", JSON.stringify(images));
    render();
}

function render(){
    const imagesDiv = document.getElementById("images");
    const bestDiv = document.getElementById("bestImage");

    if(images.length === 0){
        imagesDiv.innerHTML = "Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙˆØ±";
        bestDiv.innerHTML = "Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙˆØ±";
        return;
    }

    const best = [...images].sort((a,b)=>b.votes-a.votes)[0];

    bestDiv.innerHTML = `
        <img src="${best.src}">
        <p>â­ ${best.votes} ØªØµÙˆÙŠØª</p>
    `;

    imagesDiv.innerHTML = images.map(img => `
        <div class="box ${img.id===best.id?'best':''}">
            <img src="${img.src}">
            <p>â­ ${img.votes}</p>
            <button class="vote" onclick="vote(${img.id})">ØªØµÙˆÙŠØª</button>
        </div>
    `).join("");
}

render();
</script>

</body>
</html>
